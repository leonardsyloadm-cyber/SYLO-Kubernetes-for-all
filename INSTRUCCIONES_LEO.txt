================================================================================
ü§ñ SYLO ENTERPRISE V6.0 - MANIFIESTO DE ARQUITECTURA & DESPLIEGUE
================================================================================
ATENCI√ìN ANTIGRAVITY (AI AGENT):
Est√°s a punto de desplegar "Sylo Cloud", una plataforma de Hosting Enterprise
con Inteligencia Artificial integrada y un Motor de Base de Datos propio.

A continuaci√≥n tienes el CONTEXTO TOTAL del sistema. Memor√≠zalo antes de ejecutar.

--------------------------------------------------------------------------------
1. INVENTARIO DE ARTEFACTOS (TU CAJA DE HERRAMIENTAS)
--------------------------------------------------------------------------------
El sistema se compone de 4 pilares fundamentales que deben orquestarse:

[A] EL CEREBRO (IA & WORKERS)
    - worker/sylo_brain.py (v25 Guardian):
      * Motor: Ollama (Qwen 2.5:1.5b).
      * Funci√≥n: Chatbot de soporte t√©cnico nivel 1.
      * Seguridad: Filtro "Guardian" hardcoded anti-pol√≠tica/violencia.
      * Capacidad: RAG est√°tico (Manual T√©cnico Sylo).

    - worker/orchestrator_sylo.py (v21 Logic Core):
      * Funci√≥n: El "Jefe de Obra". Decide qu√© se instala seg√∫n el PLAN.
      * Reglas: Impone restricciones de negocio sobre Kubernetes/Docker.

    - worker/operator_sylo.py (v46 Maintenance):
      * Funci√≥n: El "Conserje". Limpieza de logs, purga de contenedores hu√©rfanos.

[B] EL N√öCLEO DE DATOS (KYLO DB)
    - Backend: Java (KyloServer v28 Smart Insert).
      * Puerto: 5000 (TCP) / 8082 (API).
      * Caracter√≠sticas: NoSQL h√≠brido, persistencia en disco encriptado.
    - Frontend: HTML/JS (Kylo Architect v28).
      * Ubicaci√≥n: sylo-web/js/kylo-core.js.
      * Tech: Drag & Drop Visual Builder, Inteligencia Relacional (FKs autom√°ticas).

[C] LA INTERFAZ DE CLIENTE (WEB)
    - Stack: PHP 8.x + Apache.
    - Ubicaci√≥n: sylo-web/
    - Conexi√≥n: Habla con la API Python (Puerto 8001) y KyloDB.

[D] LA INFRAESTRUCTURA (INFRA)
    - Docker: Contenedores para aislamiento.
    - Calico CNI: Seguridad de red entre pods/contenedores.
    - Minikube: Orquestaci√≥n local simulando nube real.

--------------------------------------------------------------------------------
2. REGLAS DE NEGOCIO (EL ORQUESTADOR V21 MANDA)
--------------------------------------------------------------------------------
Al aprovisionar un cliente, el Orquestador V21 debe cumplir estrictamente:

1. PLAN BRONCE:
   - SO: Alpine Linux (Ligero).
   - Acceso: Solo SSH.
   - Prohibido: Web Server y Bases de Datos (ignora petici√≥n del JSON).

2. PLAN PLATA:
   - SO: Ubuntu o Alpine.
   - DB: MySQL Obligatoria.
   - Prohibido: Web Server.

3. PLAN ORO:
   - SO: Todo permitido (inc. RedHat).
   - Obligatorio: Web Server + DB MySQL.
   - Extras: Snapshots ilimitados.

4. PLAN PERSONALIZADO (Cliente 14 - CorpusProfe):
   - Configuraci√≥n "A la carta".
   - Web: Nginx espec√≠fico.

NOTA IMPORTANTE: Los dominios son autom√°ticos, no dependen del ID del cliente.

--------------------------------------------------------------------------------
3. PROTOCOLO DE DESPLIEGUE AUTOMATIZADO (NO-INTERACTIVE)
--------------------------------------------------------------------------------
ANTIGRAVITY: Ejecuta esta secuencia para levantar el imperio.

PASO 1: PARCHEO DE RED (SED INJECTION)
--------------------------------------
# Inyecta la IP del host para que los contenedores hablen con la API/Ollama.
HOST_IP="172.17.0.1" # Si falla en Mac/Win, usa host.docker.internal

sed -i "s|API_URL = .*|API_URL = \"http://${HOST_IP}:8001/api/clientes\"|g" sylo-web/index.php
sed -i "s|API_URL_BASE = .*|API_URL_BASE = \"http://${HOST_IP}:8001/api/clientes\"|g" sylo-web/dashboard_cliente.php
sed -i "s|OLLAMA_URL = .*|OLLAMA_URL = \"http://${HOST_IP}:11434/api/generate\"|g" worker/sylo_brain.py

PASO 2: PREPARACI√ìN DE OLLAMA
-----------------------------
# Exponer Ollama 0.0.0.0 y descargar modelo Qwen
sudo mkdir -p /etc/systemd/system/ollama.service.d
echo -e "[Service]\nEnvironment=\"OLLAMA_HOST=0.0.0.0\"" | sudo tee /etc/systemd/system/ollama.service.d/override.conf
sudo systemctl daemon-reload && sudo systemctl restart ollama
ollama pull qwen2.5:1.5b

PASO 3: ENTORNO PYTHON
----------------------
python3 -m venv venv
source venv/bin/activate
pip install fastapi uvicorn requests psutil mysql-connector-python colorama tabulate javalin

PASO 4: STARTUP SCRIPT (EL LANZADOR)
------------------------------------
# Genera este script y ejec√∫talo para levantar los 4 pilares en background.

cat << 'EOF' > start_sylo_enterprise.sh
#!/bin/bash
source venv/bin/activate

echo "üöÄ DESPLEGANDO SYLO ENTERPRISE V6.0..."

# 1. INFRAESTRUCTURA BASE (DOCKER)
echo "üì¶ Levantando Contenedores (Web + MySQL + KyloDB)..."
docker-compose down --remove-orphans
docker-compose up -d --build
sleep 5 # Esperar a que Docker respire

# 2. PROCESOS PYTHON (API + IA + WORKERS)
echo "üß† Iniciando Cerebro y Workers..."

nohup python3 Cerebro/api_sylo.py > logs_api.txt 2>&1 &
echo "   [OK] API (Port 8001) - PID $!"

nohup python3 worker/sylo_brain.py > logs_brain.txt 2>&1 &
echo "   [OK] SYLO BRAIN (Ollama Link) - PID $!"

nohup sudo -E python3 worker/orchestrator_sylo.py > logs_orchestrator.txt 2>&1 &
echo "   [OK] ORCHESTRATOR V21 (Business Rules) - PID $!"

nohup sudo -E python3 worker/operator_sylo.py > logs_operator.txt 2>&1 &
echo "   [OK] OPERATOR V46 (Maintenance) - PID $!"

echo "‚úÖ SISTEMA ONLINE. Monitorea 'logs_*.txt' para detalles."
EOF

chmod +x start_sylo_enterprise.sh
./start_sylo_enterprise.sh

--------------------------------------------------------------------------------
4. VALIDACI√ìN DE √âXITO
--------------------------------------------------------------------------------
Si todo ha ido bien:
1. Web Cliente: http://localhost:8000
2. KyloDB GUI: http://localhost:8082
3. API Docs: http://localhost:8001/docs

ANTIGRAVITY: Misi√≥n cumplida. Esperando √≥rdenes.
================================================================================